<app-property-form (saved)="loadProperties()"></app-property-form>

<div class="max-w-6xl mx-auto p-6 space-y-8">

    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 border-b border-gray-100 pb-8">
        <div>
            <h1 class="text-3xl font-black text-gray-900 tracking-tight italic uppercase">
                {{ activeTab() === 'trash' ? 'Papelera de Activos' : 'Activos Inmobiliarios' }}
            </h1>
            <p class="text-sm font-bold text-gray-400 uppercase tracking-widest mt-1">
                {{ activeTab() === 'trash' ? 'Recuperación de unidades dadas de baja' : 'Gestión y control del inventario técnico' }}
            </p>
        </div>

        <div class="flex items-center gap-3">
            <div class="flex bg-gray-100 p-1 rounded-2xl mr-2">
                <button (click)="toggleTab('active')"
                    [class.bg-white]="activeTab() === 'active'"
                    [class.shadow-sm]="activeTab() === 'active'"
                    class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all cursor-pointer">
                    Activos
                </button>
                <button (click)="toggleTab('trash')"
                    [class.bg-white]="activeTab() === 'trash'"
                    [class.text-red-600]="activeTab() === 'trash'"
                    class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all cursor-pointer flex items-center gap-2">
                    Papelera
                </button>
            </div>

            <button (click)="propertyForm.open()"
                class="flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-2xl font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-100 active:scale-95 cursor-pointer">
                <span class="text-xl">+</span>
                Nuevo Activo
            </button>
        </div>
    </div>

    @if (isLoading()) {
    <div class="flex flex-col items-center justify-center py-20 space-y-4">
        <div class="w-10 h-10 border-4 border-indigo-100 border-t-indigo-600 rounded-full animate-spin"></div>
        <span class="text-[10px] font-black uppercase text-gray-400 tracking-widest italic">Sincronizando inventario...</span>
    </div>
    } @else {
        <div class="animate-in fade-in slide-in-from-bottom-2 duration-500">
            <div class="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden" 
                 [class.border-red-100]="activeTab() === 'trash'"
                 [class.bg-gray-50]="activeTab() === 'trash'">
                <ng-container *ngTemplateOutlet="propertyTable; context: { items: filteredProperties() }"></ng-container>
            </div>
        </div>
    }
</div>

<ng-template #propertyTable let-items="items">
    <table class="w-full text-left">
        <thead class="bg-gray-50/50">
            <tr>
                <th class="p-4 text-[10px] font-black uppercase text-gray-400 tracking-widest border-b border-gray-100">Activo / Ref</th>
                <th class="p-4 text-[10px] font-black uppercase text-gray-400 tracking-widest border-b border-gray-100">Ubicación</th>
                <th class="p-4 text-[10px] font-black uppercase text-gray-400 tracking-widest border-b border-gray-100 text-center">Superficie</th>
                <th class="p-4 text-[10px] font-black uppercase text-gray-400 tracking-widest border-b border-gray-100 text-center">Estado</th>
                <th class="p-4 text-[10px] font-black uppercase text-gray-400 tracking-widest border-b border-gray-100 text-right">Acción</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            @for (prop of items; track prop.id) {
                <tr class="hover:bg-indigo-50/30 transition-colors group">
                    <td class="p-4">
                        <div class="font-bold text-gray-900">{{ prop.internalCode }}</div>
                        <div class="text-[10px] text-gray-400 font-black uppercase">
                            {{ prop.type }} • {{ prop.bedrooms }} DORM • {{ prop.bathrooms }} BAÑOS
                        </div>
                    </td>
                    <td class="p-4 text-xs font-bold text-gray-700">
                        {{ prop.address.addressLine1 }}
                        <div class="text-[9px] text-gray-400 uppercase font-black">{{ prop.address.city }}</div>
                    </td>
                    <td class="p-4 text-center">
                        <div class="font-black text-indigo-600 text-xs">{{ prop.surfaceUseful }}m²</div>
                        <div class="text-[9px] text-gray-400 uppercase font-black">Útiles</div>
                    </td>
                    <td class="p-4 text-center">
                        <span class="px-2 py-1 rounded-lg text-[9px] font-black uppercase"
                            [ngClass]="{
                                'bg-green-100 text-green-700': prop.status === 'AVAILABLE',
                                'bg-amber-100 text-amber-700': prop.status === 'RENTED',
                                'bg-gray-100 text-gray-500': prop.status === 'MAINTENANCE'
                            }">
                            {{ prop.status }}
                        </span>
                    </td>
                    <td class="p-4 text-right">
                        @if (activeTab() === 'trash') {
                            <button (click)="onRestore(prop.id)"
                                class="px-3 py-1 bg-green-50 text-green-600 rounded-lg text-[10px] font-black uppercase tracking-tighter hover:bg-green-600 hover:text-white transition-all cursor-pointer">
                                Restaurar
                            </button>
                        } @else {
                            <div class="flex justify-end gap-2">
                                <button (click)="editProperty(prop)" class="text-gray-300 hover:text-indigo-600 p-1 cursor-pointer">✎</button>
                                <button (click)="deleteProperty(prop.id)" class="text-gray-300 hover:text-red-500 p-1 cursor-pointer">✕</button>
                            </div>
                        }
                    </td>
                </tr>
            } @empty {
                <tr>
                    <td colspan="5" class="p-12 text-center opacity-30 italic text-xs font-bold">
                        No hay activos disponibles en esta sección
                    </td>
                </tr>
            }
        </tbody>
    </table>
</ng-template>